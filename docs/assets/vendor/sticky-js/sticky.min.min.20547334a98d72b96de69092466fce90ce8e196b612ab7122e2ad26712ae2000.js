function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(d,c){for(var b=0,a;b<c.length;b++)a=c[b],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Sticky=function(){function a(){var c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,a),this.selector=c,this.elements=[],this.version="1.3.0",this.vp=this.getViewportSize(),this.body=document.querySelector("body"),this.options={wrap:b.wrap||!1,wrapWith:b.wrapWith||"<span></span>",marginTop:b.marginTop||0,marginBottom:b.marginBottom||0,stickyFor:b.stickyFor||0,stickyClass:b.stickyClass||null,stickyContainer:b.stickyContainer||"body"},this.updateScrollTopPosition=this.updateScrollTopPosition.bind(this),this.updateScrollTopPosition(),window.addEventListener("load",this.updateScrollTopPosition),window.addEventListener("scroll",this.updateScrollTopPosition),this.run()}return _createClass(a,[{key:"run",value:function(){var a=this,b=setInterval(function(){if("complete"===document.readyState){clearInterval(b);var c=document.querySelectorAll(a.selector);a.forEach(c,function(b){return a.renderElement(b)})}},10)}},{key:"renderElement",value:function(a){var b=this;a.sticky={},a.sticky.active=!1,a.sticky.marginTop=parseInt(a.getAttribute("data-margin-top"))||this.options.marginTop,a.sticky.marginBottom=parseInt(a.getAttribute("data-margin-bottom"))||this.options.marginBottom,a.sticky.stickyFor=parseInt(a.getAttribute("data-sticky-for"))||this.options.stickyFor,a.sticky.stickyClass=a.getAttribute("data-sticky-class")||this.options.stickyClass,a.sticky.wrap=!!a.hasAttribute("data-sticky-wrap")||this.options.wrap,a.sticky.stickyContainer=this.options.stickyContainer,a.sticky.container=this.getStickyContainer(a),a.sticky.container.rect=this.getRectangle(a.sticky.container),a.sticky.rect=this.getRectangle(a),"img"===a.tagName.toLowerCase()&&(a.onload=function(){return a.sticky.rect=b.getRectangle(a)}),a.sticky.wrap&&this.wrapElement(a),this.activate(a)}},{key:"wrapElement",value:function(a){a.insertAdjacentHTML("beforebegin",a.getAttribute("data-sticky-wrapWith")||this.options.wrapWith),a.previousSibling.appendChild(a)}},{key:"activate",value:function(a){a.sticky.rect.top+a.sticky.rect.height<a.sticky.container.rect.top+a.sticky.container.rect.height&&a.sticky.stickyFor<this.vp.width&&!a.sticky.active&&(a.sticky.active=!0),this.elements.indexOf(a)<0&&this.elements.push(a),a.sticky.resizeEvent||(this.initResizeEvents(a),a.sticky.resizeEvent=!0),a.sticky.scrollEvent||(this.initScrollEvents(a),a.sticky.scrollEvent=!0),this.setPosition(a)}},{key:"initResizeEvents",value:function(a){var b=this;a.sticky.resizeListener=function(){return b.onResizeEvents(a)},window.addEventListener("resize",a.sticky.resizeListener)}},{key:"destroyResizeEvents",value:function(a){window.removeEventListener("resize",a.sticky.resizeListener)}},{key:"onResizeEvents",value:function(a){this.vp=this.getViewportSize(),a.sticky.rect=this.getRectangle(a),a.sticky.container.rect=this.getRectangle(a.sticky.container),a.sticky.rect.top+a.sticky.rect.height<a.sticky.container.rect.top+a.sticky.container.rect.height&&a.sticky.stickyFor<this.vp.width&&!a.sticky.active?a.sticky.active=!0:(a.sticky.rect.top+a.sticky.rect.height>=a.sticky.container.rect.top+a.sticky.container.rect.height||a.sticky.stickyFor>=this.vp.width&&a.sticky.active)&&(a.sticky.active=!1),this.setPosition(a)}},{key:"initScrollEvents",value:function(a){var b=this;a.sticky.scrollListener=function(){return b.onScrollEvents(a)},window.addEventListener("scroll",a.sticky.scrollListener)}},{key:"destroyScrollEvents",value:function(a){window.removeEventListener("scroll",a.sticky.scrollListener)}},{key:"onScrollEvents",value:function(a){a.sticky&&a.sticky.active&&this.setPosition(a)}},{key:"setPosition",value:function(a){this.css(a,{position:"",width:"",top:"",left:""}),this.vp.height<a.sticky.rect.height||!a.sticky.active||(a.sticky.rect.width||(a.sticky.rect=this.getRectangle(a)),a.sticky.wrap&&this.css(a.parentNode,{display:"block",width:a.sticky.rect.width+"px",height:a.sticky.rect.height+"px"}),0===a.sticky.rect.top&&a.sticky.container===this.body?(this.css(a,{position:"fixed",top:a.sticky.rect.top+"px",left:a.sticky.rect.left+"px",width:a.sticky.rect.width+"px"}),a.sticky.stickyClass&&a.classList.add(a.sticky.stickyClass)):this.scrollTop>a.sticky.rect.top-a.sticky.marginTop?(this.css(a,{position:"fixed",width:a.sticky.rect.width+"px",left:a.sticky.rect.left+"px"}),this.scrollTop+a.sticky.rect.height+a.sticky.marginTop>a.sticky.container.rect.top+a.sticky.container.offsetHeight-a.sticky.marginBottom?(a.sticky.stickyClass&&a.classList.remove(a.sticky.stickyClass),this.css(a,{top:a.sticky.container.rect.top+a.sticky.container.offsetHeight-(this.scrollTop+a.sticky.rect.height+a.sticky.marginBottom)+"px"})):(a.sticky.stickyClass&&a.classList.add(a.sticky.stickyClass),this.css(a,{top:a.sticky.marginTop+"px"}))):(a.sticky.stickyClass&&a.classList.remove(a.sticky.stickyClass),this.css(a,{position:"",width:"",top:"",left:""}),a.sticky.wrap&&this.css(a.parentNode,{display:"",width:"",height:""})))}},{key:"update",value:function(){var a=this;this.forEach(this.elements,function(b){b.sticky.rect=a.getRectangle(b),b.sticky.container.rect=a.getRectangle(b.sticky.container),a.activate(b),a.setPosition(b)})}},{key:"destroy",value:function(){var a=this;window.removeEventListener("load",this.updateScrollTopPosition),window.removeEventListener("scroll",this.updateScrollTopPosition),this.forEach(this.elements,function(b){a.destroyResizeEvents(b),a.destroyScrollEvents(b),delete b.sticky})}},{key:"getStickyContainer",value:function(b){for(var a=b.parentNode;!a.hasAttribute("data-sticky-container")&&!a.parentNode.querySelector(b.sticky.stickyContainer)&&a!==this.body;)a=a.parentNode;return a}},{key:"getRectangle",value:function(a){this.css(a,{position:"",width:"",top:"",left:""});for(var d=Math.max(a.offsetWidth,a.clientWidth,a.scrollWidth),e=Math.max(a.offsetHeight,a.clientHeight,a.scrollHeight),b=0,c=0;b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;);return{top:b,left:c,width:d,height:e}}},{key:"getViewportSize",value:function(){return{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}}},{key:"updateScrollTopPosition",value:function(){this.scrollTop=(window.pageYOffset||document.scrollTop)-(document.clientTop||0)||0}},{key:"forEach",value:function(b,c){for(var a=0,d=b.length;a<d;a++)c(b[a])}},{key:"css",value:function(c,a){for(var b in a)a.hasOwnProperty(b)&&(c.style[b]=a[b])}}]),a}();!function(b,a){"undefined"!=typeof exports?module.exports=a:"function"==typeof define&&define.amd?define([],function(){return a}):b.Sticky=a}(this,Sticky)